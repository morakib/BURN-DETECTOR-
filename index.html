<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burn Classifier</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            transition: background-color 0.5s ease;
        }

        /* Theme Background Changes */
        body.theme-red {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
        }

        body.theme-yellow {
            background: linear-gradient(135deg, #fffde7, #fff9c4);
        }

        body.theme-green {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
        }

        body.theme-black {
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
        }

        /* Container adapts to theme */
        body.theme-red .container {
            border: 2px solid #f44336;
            box-shadow: 0 4px 20px rgba(244, 67, 54, 0.2);
        }

        body.theme-yellow .container {
            border: 2px solid #ff9800;
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.2);
        }

        body.theme-green .container {
            border: 2px solid #4caf50;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.2);
        }

        body.theme-black .container {
            border: 2px solid #757575;
            box-shadow: 0 4px 20px rgba(117, 117, 117, 0.2);
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .upload-area.dragover {
            border-color: #007bff;
            background-color: #e3f2fd;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        
        .preview-container {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .analyze-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            display: none;
        }
        
        .analyze-btn:hover {
            background: #0056b3;
        }
        
        .analyze-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .result-label {
            font-weight: bold;
            color: #333;
        }
        
        .result-value {
            font-size: 18px;
            color: #007bff;
            margin-top: 5px;
        }
        
        .confidence {
            color: #28a745;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            display: none;
        }

        /* Body Part Selection Styles */
        .body-selection {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .body-selection h3 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .body-diagrams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .body-diagrams {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .body-diagram {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 2px solid #e9ecef;
        }

        @media (max-width: 480px) {
            .body-diagram {
                padding: 15px;
            }
        }

        .body-diagram h4 {
            margin-bottom: 20px;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .body-svg {
            width: 100%;
            max-width: 400px;
            height: 400px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }

        @media (max-width: 480px) {
            .body-svg {
                max-width: 300px;
                height: 300px;
            }
        }

        .part-label {
            font-size: 11px;
            font-weight: 600;
            fill: #333;
            text-anchor: start;
        }

        @media (max-width: 480px) {
            .part-label {
                font-size: 9px;
            }
        }

        .body-part {
            fill: #e9ecef;
            stroke: #6c757d;
            stroke-width: 1.5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .body-part:hover {
            fill: #ffc107;
            stroke: #fd7e14;
            stroke-width: 2.5;
            filter: drop-shadow(0 2px 4px rgba(255, 193, 7, 0.4));
        }

        .body-part.selected {
            fill: #dc3545;
            stroke: #721c24;
            stroke-width: 2.5;
            filter: drop-shadow(0 2px 4px rgba(220, 53, 69, 0.4));
        }

        .part-label {
            font-size: 10px;
            font-weight: 600;
            fill: #495057;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }

        .percentage-label {
            font-size: 8px;
            fill: #6c757d;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }

        .selection-summary {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .selection-summary h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .tbsa-display {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #dc3545;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .selected-parts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
            min-height: 40px;
            align-items: center;
        }

        .selected-part {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
            transition: transform 0.2s ease;
        }

        .selected-part:hover {
            transform: translateY(-1px);
        }

        .weight-input {
            margin: 25px 0;
            background: white;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .weight-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .weight-input label {
            font-weight: 600;
            color: #333;
            font-size: 18px;
            white-space: nowrap;
        }

        @media (max-width: 480px) {
            .weight-input label {
                font-size: 16px;
            }
        }

        .weight-input-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weight-input input {
            width: 120px;
            padding: 15px 20px;
            border: 2px solid #ced4da;
            border-radius: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .weight-input input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.15);
            background: white;
            transform: scale(1.02);
        }

        .weight-input input:hover {
            border-color: #007bff;
            background: white;
        }

        .weight-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .weight-btn {
            width: 35px;
            height: 35px;
            border: 2px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .weight-btn:hover {
            background: #0056b3;
            transform: scale(1.1);
        }

        .weight-btn:active {
            transform: scale(0.95);
        }

        .weight-unit {
            font-size: 16px;
            font-weight: 600;
            color: #666;
            padding: 10px;
            background: #e9ecef;
            border-radius: 8px;
            min-width: 30px;
            text-align: center;
        }

        .weight-presets {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            border: 2px solid #6c757d;
            background: white;
            color: #6c757d;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: #6c757d;
            color: white;
            transform: translateY(-1px);
        }

        @media (max-width: 480px) {
            .weight-input {
                padding: 20px;
                margin: 20px 10px;
            }
            
            .weight-input-group {
                flex-direction: column;
                gap: 15px;
            }
            
            .weight-input input {
                width: 100px;
                font-size: 18px;
            }
            
            .preset-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
        }

        /* Triage Section Styles */
        .triage-section {
            margin-top: 30px;
            padding: 25px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border: 3px solid #e9ecef;
            display: none;
        }

        .triage-section.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .triage-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .triage-header h3 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .triage-result {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid;
            font-weight: 600;
            font-size: 18px;
        }

        .triage-red {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border-color: #a71e2a;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .triage-yellow {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
            border-color: #b69500;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .triage-green {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            border-color: #155724;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .triage-black {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border-color: #343a40;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .triage-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .triage-details {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .triage-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .triage-info h4 {
            margin: 0 0 10px 0;
            color: #007bff;
            font-size: 16px;
        }

        .triage-info p {
            margin: 5px 0;
            color: #333;
            font-size: 14px;
        }

        .action-required {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .action-required h4 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .no-fluid-note {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            min-width: 200px;
        }

        @media (max-width: 480px) {
            .calculate-btn {
                padding: 12px 30px;
                font-size: 16px;
                min-width: 180px;
                margin: 20px auto;
            }
        }

        .calculate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }

        .calculate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .fluid-results {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            display: none;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
        }

        .fluid-results h4 {
            color: #155724;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
        }

        .fluid-item {
            margin: 15px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            font-size: 15px;
        }

        .fluid-item strong {
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔥 Burn Classification Tool</h1>
        
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <span class="upload-icon">📸</span>
            <div class="upload-text">Click to upload burn image</div>
            <div style="font-size: 14px; color: #999;">Supports JPG, PNG, GIF</div>
            <input type="file" id="fileInput" accept="image/*">
        </div>
        
        <div class="preview-container" id="previewContainer">
            <img id="previewImage" class="preview-image" alt="Preview">
            <br>
            <button class="analyze-btn" id="analyzeBtn">🔍 Analyze Burn</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>Analyzing image...</div>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="results" id="results">
            <h3>Analysis Results</h3>
            <div class="result-item">
                <div class="result-label">Burn Type:</div>
                <div class="result-value" id="burnType"></div>
            </div>
            <div class="result-item">
                <div class="result-label">Confidence:</div>
                <div class="result-value confidence" id="confidence"></div>
            </div>
        </div>

        <!-- Body Part Selection -->
        <div class="body-selection" id="bodySelection">
            <h3>🎯 Select Affected Body Parts</h3>
            <div style="text-align: center; color: #666; margin-bottom: 30px; font-size: 16px; line-height: 1.5;">
                Click on the body parts that have burns to calculate Total Body Surface Area (TBSA)<br>
                <small style="color: #999;">Based on the Rule of Nines for adult patients</small>
            </div>
            
            <div class="body-diagrams">
                <!-- Front View -->
                <div class="body-diagram">
                    <h4>🧍 Front View</h4>
                    <svg class="body-svg" viewBox="0 0 450 400">
                        <!-- Head -->
                        <ellipse cx="225" cy="40" rx="25" ry="30" class="body-part" id="head" data-tbsa="9" data-name="Head & Neck"/>
                        <text x="275" y="30" class="part-label">Head 9%</text>
                        
                        <!-- Chest -->
                        <rect x="190" y="70" width="70" height="50" rx="5" class="body-part" id="chest" data-tbsa="9" data-name="Chest"/>
                        <text x="225" y="98" class="part-label">Chest 9%</text>
                        
                        <!-- Abdomen -->
                        <rect x="190" y="120" width="70" height="45" rx="5" class="body-part" id="abdomen" data-tbsa="9" data-name="Abdomen"/>
                        <text x="225" y="145" class="part-label">Abdomen 9%</text>
                        
                        <!-- Left Arm -->
                        <rect x="145" y="75" width="25" height="65" rx="12" class="body-part" id="leftArm" data-tbsa="9" data-name="Left Arm"/>
                        <text x="100" y="100" class="part-label">Left Arm 9%</text>
                        
                        <!-- Right Arm -->
                        <rect x="280" y="75" width="25" height="65" rx="12" class="body-part" id="rightArm" data-tbsa="9" data-name="Right Arm"/>
                        <text x="350" y="100" class="part-label">Right Arm 9%</text>
                        
                        <!-- Genitals -->
                        <rect x="210" y="165" width="30" height="20" rx="3" class="body-part" id="genitals" data-tbsa="1" data-name="Genitals"/>
                        <text x="300" y="178" class="part-label">Genitals 1%</text>
                        
                        <!-- Left Thigh -->
                        <rect x="200" y="185" width="20" height="70" rx="8" class="body-part" id="leftThigh" data-tbsa="9" data-name="Left Thigh"/>
                        <text x="150" y="220" class="part-label">Left Thigh 9%</text>
                        
                        <!-- Right Thigh -->
                        <rect x="230" y="185" width="20" height="70" rx="8" class="body-part" id="rightThigh" data-tbsa="9" data-name="Right Thigh"/>
                        <text x="300" y="220" class="part-label">Right Thigh 9%</text>
                        
                        <!-- Left Lower Leg -->
                        <rect x="200" y="255" width="20" height="70" rx="8" class="body-part" id="leftLeg" data-tbsa="9" data-name="Left Lower Leg"/>
                        <text x="150" y="290" class="part-label">Left Leg 9%</text>
                        
                        <!-- Right Lower Leg -->
                        <rect x="230" y="255" width="20" height="70" rx="8" class="body-part" id="rightLeg" data-tbsa="9" data-name="Right Lower Leg"/>
                        <text x="300" y="290" class="part-label">Right Leg 9%</text>
                        
                        <!-- Left Foot -->
                        <ellipse cx="210" cy="340" rx="12" ry="18" class="body-part" id="leftFoot" data-tbsa="3.5" data-name="Left Foot"/>
                        <text x="150" y="350" class="part-label">Left Foot 3.5%</text>
                        
                        <!-- Right Foot -->
                        <ellipse cx="240" cy="340" rx="12" ry="18" class="body-part" id="rightFoot" data-tbsa="3.5" data-name="Right Foot"/>
                        <text x="300" y="350" class="part-label">Right Foot 3.5%</text>
                    </svg>
                </div>

                <!-- Back View -->
                <div class="body-diagram">
                    <h4>🧍‍♂️ Back View</h4>
                    <svg class="body-svg" viewBox="0 0 450 400">
                        <!-- Head Back -->
                        <ellipse cx="225" cy="40" rx="25" ry="30" class="body-part" id="headBack" data-tbsa="9" data-name="Head & Neck (Back)"/>
                        <text x="275" y="30" class="part-label">Head 9%</text>
                        
                        <!-- Upper Back -->
                        <rect x="190" y="70" width="70" height="50" rx="5" class="body-part" id="upperBack" data-tbsa="9" data-name="Upper Back"/>
                        <text x="225" y="98" class="part-label">Upper Back 9%</text>
                        
                        <!-- Lower Back -->
                        <rect x="190" y="120" width="70" height="45" rx="5" class="body-part" id="lowerBack" data-tbsa="9" data-name="Lower Back"/>
                        <text x="225" y="145" class="part-label">Lower Back 9%</text>
                        
                        <!-- Left Arm Back -->
                        <rect x="145" y="75" width="25" height="65" rx="12" class="body-part" id="leftArmBack" data-tbsa="9" data-name="Left Arm (Back)"/>
                        <text x="100" y="100" class="part-label">Left Arm 9%</text>
                        
                        <!-- Right Arm Back -->
                        <rect x="280" y="75" width="25" height="65" rx="12" class="body-part" id="rightArmBack" data-tbsa="9" data-name="Right Arm (Back)"/>
                        <text x="350" y="100" class="part-label">Right Arm 9%</text>
                        
                        <!-- Buttocks -->
                        <rect x="190" y="165" width="70" height="35" rx="5" class="body-part" id="buttocks" data-tbsa="9" data-name="Buttocks"/>
                        <text x="225" y="185" class="part-label">Buttocks 9%</text>
                        
                        <!-- Left Thigh Back -->
                        <rect x="200" y="200" width="20" height="55" rx="8" class="body-part" id="leftThighBack" data-tbsa="9" data-name="Left Thigh (Back)"/>
                        <text x="150" y="225" class="part-label">L.Thigh 9%</text>
                        
                        <!-- Right Thigh Back -->
                        <rect x="230" y="200" width="20" height="55" rx="8" class="body-part" id="rightThighBack" data-tbsa="9" data-name="Right Thigh (Back)"/>
                        <text x="300" y="225" class="part-label">R.Thigh 9%</text>
                        
                        <!-- Left Lower Leg Back -->
                        <rect x="200" y="255" width="20" height="70" rx="8" class="body-part" id="leftLegBack" data-tbsa="9" data-name="Left Lower Leg (Back)"/>
                        <text x="150" y="285" class="part-label">L.Leg 9%</text>
                        
                        <!-- Right Lower Leg Back -->
                        <rect x="230" y="255" width="20" height="70" rx="8" class="body-part" id="rightLegBack" data-tbsa="9" data-name="Right Lower Leg (Back)"/>
                        <text x="300" y="285" class="part-label">R.Leg 9%</text>
                        
                        <!-- Feet Back -->
                        <ellipse cx="210" cy="340" rx="12" ry="18" class="body-part" id="leftFootBack" data-tbsa="3.5" data-name="Left Foot (Back)"/>
                        <text x="150" y="350" class="part-label">L.Foot 3.5%</text>
                        
                        <ellipse cx="240" cy="340" rx="12" ry="18" class="body-part" id="rightFootBack" data-tbsa="3.5" data-name="Right Foot (Back)"/>
                        <text x="300" y="350" class="part-label">R.Foot 3.5%</text>
                    </svg>
                </div>
            </div>

            <!-- Selection Summary -->
            <div class="selection-summary">
                <h4>Selected Body Parts</h4>
                <div class="selected-parts" id="selectedParts">
                    <span style="color: #666; font-style: italic;">No parts selected</span>
                </div>
                <div class="tbsa-display">
                    Total TBSA: <span id="totalTBSA">0</span>%
                </div>
            </div>

            <!-- Weight Input -->
            <div class="weight-input">
                <div class="weight-input-group">
                    <label for="patientWeight">👤 Patient Weight:</label>
                    <div class="weight-input-container">
                        <div class="weight-controls">
                            <button class="weight-btn" onclick="adjustWeight(5)">+</button>
                            <button class="weight-btn" onclick="adjustWeight(-5)">−</button>
                        </div>
                        <input type="number" id="patientWeight" value="70" min="5" max="300" step="1" oninput="validateWeight()">
                        <div class="weight-unit">kg</div>
                    </div>
                </div>
                
                <!-- Quick Presets -->
                <div class="weight-presets">
                    <button class="preset-btn" onclick="setWeight(50)">Child (50kg)</button>
                    <button class="preset-btn" onclick="setWeight(70)">Adult (70kg)</button>
                    <button class="preset-btn" onclick="setWeight(80)">Large Adult (80kg)</button>
                </div>
            </div>

            <!-- Calculate Button -->
            <button class="calculate-btn" id="calculateBtn" disabled onclick="calculateFluidRequirements()">
                💧 Calculate Fluid Requirements
            </button>

            <!-- Fluid Results -->
            <div class="fluid-results" id="fluidResults">
                <h4>Parkland Formula Results</h4>
                <div class="fluid-item">
                    <strong>Formula:</strong> 4ml × Weight(kg) × %TBSA
                </div>
                <div class="fluid-item">
                    <strong>Total 24h Fluid:</strong> <span id="total24h"></span> ml
                </div>
                <div class="fluid-item">
                    <strong>First 8 hours:</strong> <span id="first8h"></span> ml (<span id="hourly8h"></span> ml/hr)
                </div>
                <div class="fluid-item">
                    <strong>Next 16 hours:</strong> <span id="next16h"></span> ml (<span id="hourly16h"></span> ml/hr)
                </div>
            </div>

            <!-- Triage Assessment -->
            <div class="triage-section" id="triageSection">
                <div class="triage-header">
                    <h3>🚨 Patient Triage Assessment</h3>
                    <p>Based on TBSA and burn characteristics</p>
                </div>
                
                <div class="triage-result" id="triageResult">
                    <!-- Triage category will be populated here -->
                </div>
                
                <div class="triage-details">
                    <div class="triage-info">
                        <h4>📊 Assessment Summary</h4>
                        <p><strong>Total TBSA:</strong> <span id="triageTBSA"></span>%</p>
                        <p><strong>Patient Weight:</strong> <span id="triageWeight"></span> kg</p>
                        <p><strong>Category:</strong> <span id="triageCategory"></span></p>
                    </div>
                    
                    <div class="triage-info">
                        <h4>⚡ Immediate Actions</h4>
                        <p id="triageActions">Actions will be displayed here</p>
                    </div>
                </div>
                
                <div class="action-required" id="actionRequired">
                    <h4>🏥 Recommended Treatment Plan</h4>
                    <p id="treatmentPlan">Treatment recommendations will appear here</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;

        // File input handling
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleFileSelect(file);
            }
        });

        // Drag and drop handling
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        function handleFileSelect(file) {
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file.');
                return;
            }

            selectedFile = file;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('previewContainer').style.display = 'block';
                document.getElementById('analyzeBtn').style.display = 'inline-block';
                hideError();
                hideResults();
            };
            reader.readAsDataURL(file);
        }

        // Analyze button
        document.getElementById('analyzeBtn').addEventListener('click', async function() {
            if (!selectedFile) {
                showError('Please select an image first.');
                return;
            }

            showLoading();
            hideError();
            hideResults();

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch('http://127.0.0.1:8000/predict/', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                showResults(result);

            } catch (error) {
                console.error('Error:', error);
                showError('Error analyzing image: ' + error.message + '. Make sure the server is running.');
            } finally {
                hideLoading();
            }
        });

        function showResults(result) {
            document.getElementById('burnType').textContent = result.predicted_class || result.prediction || 'Unknown';
            document.getElementById('confidence').textContent = ((result.confidence || 0) * 100).toFixed(1) + '%';
            document.getElementById('results').style.display = 'block';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analyzeBtn').disabled = true;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = false;
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        // Body Part Selection Variables
        let selectedBodyParts = new Set();
        let totalTBSA = 0;

        // Initialize body part selection
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to all body parts
            document.querySelectorAll('.body-part').forEach(part => {
                part.addEventListener('click', function() {
                    toggleBodyPart(this);
                });
            });
        });

        function toggleBodyPart(element) {
            const partId = element.id;
            const tbsa = parseInt(element.dataset.tbsa);
            const name = element.dataset.name;

            if (selectedBodyParts.has(partId)) {
                // Deselect
                selectedBodyParts.delete(partId);
                element.classList.remove('selected');
                totalTBSA -= tbsa;
            } else {
                // Select
                selectedBodyParts.add(partId);
                element.classList.add('selected');
                totalTBSA += tbsa;

                // Handle combined parts (head front/back, arms, etc.)
                handleCombinedParts(partId, tbsa, true);
            }

            updateSelectionDisplay();
        }

        function handleCombinedParts(partId, tbsa, isSelecting) {
            // Prevent double counting for combined parts
            const combinedParts = {
                'head': 'headBack',
                'headBack': 'head',
                'leftArm': 'leftArmBack', 
                'leftArmBack': 'leftArm',
                'rightArm': 'rightArmBack',
                'rightArmBack': 'rightArm',
                'leftThigh': 'leftThighBack',
                'leftThighBack': 'leftThigh',
                'rightThigh': 'rightThighBack', 
                'rightThighBack': 'rightThigh',
                'leftLeg': 'leftLegBack',
                'leftLegBack': 'leftLeg',
                'rightLeg': 'rightLegBack',
                'rightLegBack': 'rightLeg'
            };

            const counterpart = combinedParts[partId];
            if (counterpart && selectedBodyParts.has(counterpart)) {
                if (isSelecting) {
                    // Both front and back selected, don't double count
                    totalTBSA -= tbsa;
                }
            }
        }

        function updateSelectionDisplay() {
            const selectedPartsDiv = document.getElementById('selectedParts');
            const totalTBSASpan = document.getElementById('totalTBSA');
            const calculateBtn = document.getElementById('calculateBtn');

            // Update TBSA display
            totalTBSASpan.textContent = totalTBSA;

            // Update selected parts display
            if (selectedBodyParts.size === 0) {
                selectedPartsDiv.innerHTML = '<span style="color: #666; font-style: italic;">No parts selected</span>';
                calculateBtn.disabled = true;
            } else {
                const partsList = Array.from(selectedBodyParts).map(partId => {
                    const element = document.getElementById(partId);
                    return `<span class="selected-part">${element.dataset.name}</span>`;
                }).join('');
                selectedPartsDiv.innerHTML = partsList;
                calculateBtn.disabled = false;
            }
        }

        // Weight control functions
        function adjustWeight(change) {
            const weightInput = document.getElementById('patientWeight');
            let currentWeight = parseInt(weightInput.value) || 70;
            let newWeight = currentWeight + change;
            
            // Keep within bounds
            newWeight = Math.max(5, Math.min(300, newWeight));
            
            weightInput.value = newWeight;
            validateWeight();
        }

        function setWeight(weight) {
            const weightInput = document.getElementById('patientWeight');
            weightInput.value = weight;
            validateWeight();
        }

        function validateWeight() {
            const weightInput = document.getElementById('patientWeight');
            const weight = parseInt(weightInput.value);
            
            // Visual feedback for valid/invalid weight
            if (weight && weight >= 5 && weight <= 300) {
                weightInput.style.borderColor = '#28a745';
                weightInput.style.background = '#f8fff9';
            } else {
                weightInput.style.borderColor = '#dc3545';
                weightInput.style.background = '#fff5f5';
            }
        }

        function calculateFluidRequirements() {
            const weight = parseFloat(document.getElementById('patientWeight').value);
            
            if (!weight || weight < 5 || weight > 300) {
                alert('Please enter a valid weight (5-300 kg)');
                return;
            }

            if (totalTBSA === 0) {
                alert('Please select at least one affected body part');
                return;
            }

            // Check if fluid resuscitation is needed (TBSA >= 15%)
            if (totalTBSA >= 15) {
                // Parkland Formula: 4ml × weight(kg) × %TBSA for first 24 hours
                const total24h = 4 * weight * totalTBSA;
                const first8h = total24h / 2; // Half in first 8 hours
                const next16h = total24h / 2; // Half in next 16 hours
                const hourly8h = first8h / 8;
                const hourly16h = next16h / 16;

                // Display fluid results
                document.getElementById('total24h').textContent = Math.round(total24h);
                document.getElementById('first8h').textContent = Math.round(first8h);
                document.getElementById('next16h').textContent = Math.round(next16h);
                document.getElementById('hourly8h').textContent = Math.round(hourly8h);
                document.getElementById('hourly16h').textContent = Math.round(hourly16h);
                
                document.getElementById('fluidResults').style.display = 'block';
            } else {
                // Hide fluid results for TBSA < 15%
                document.getElementById('fluidResults').style.display = 'none';
            }

            // Perform triage assessment
            performTriageAssessment(weight, totalTBSA);
        }

        function performTriageAssessment(weight, tbsa) {
            const triageSection = document.getElementById('triageSection');
            const triageResult = document.getElementById('triageResult');
            const triageTBSA = document.getElementById('triageTBSA');
            const triageWeight = document.getElementById('triageWeight');
            const triageCategory = document.getElementById('triageCategory');
            const triageActions = document.getElementById('triageActions');
            const treatmentPlan = document.getElementById('treatmentPlan');

            // Update basic info
            triageTBSA.textContent = tbsa;
            triageWeight.textContent = weight;

            let category, actions, treatment, className, themeColor;

            // Triage logic based on the chart
            if (tbsa > 85 || (tbsa > 15 && weight < 10)) {
                // BLACK - Expectant
                category = "BLACK (Expectant)";
                className = "triage-black";
                themeColor = "black";
                actions = "• Provide comfort care<br>• Do not resuscitate<br>• Focus resources on salvageable patients";
                treatment = "Palliative care only. Patient likely non-survivable with current resources. Focus on pain management and comfort measures.";
            } else if (tbsa > 15 || (tbsa > 10 && weight < 70)) {
                // RED - Critical/Immediate
                category = "RED (Critical - Immediate)";
                className = "triage-red";
                themeColor = "red";
                actions = "• Immediate resuscitation<br>• Secure airway if needed<br>• Start IV fluid resuscitation<br>• Transfer to burn center ASAP";
                treatment = "Immediate life-saving interventions required. Start Parkland formula, monitor closely, prepare for emergency transfer to specialized burn center.";
            } else if (tbsa >= 10 && tbsa <= 15) {
                // YELLOW - Delayed
                category = "YELLOW (Delayed)";
                className = "triage-yellow";
                themeColor = "yellow";
                actions = "• Admit for monitoring<br>• Pain management<br>• Wound care<br>• Prepare for delayed surgical treatment";
                treatment = "Serious but stable condition. Can wait for treatment after critical patients. Monitor for complications and prepare for potential surgery.";
            } else {
                // GREEN - Minimal
                category = "GREEN (Minimal)";
                className = "triage-green";
                themeColor = "green";
                actions = "• Outpatient wound care<br>• Pain relief<br>• Patient education<br>• Follow-up appointments";
                treatment = "Minor burns suitable for outpatient management. Focus on wound care, pain control, and patient education for home care.";
            }

            // Special considerations for fluid requirements
            let fluidNote = "";
            if (tbsa < 15) {
                fluidNote = '<div class="no-fluid-note">💡 <strong>No IV Fluid Resuscitation Required</strong><br>TBSA < 15% - Oral hydration sufficient</div>';
            }

            // Update display
            triageResult.className = `triage-result ${className}`;
            triageResult.innerHTML = `<strong>${category}</strong><br>Patient requires ${category.split('(')[1].replace(')', '').toLowerCase()} priority treatment`;
            
            triageCategory.textContent = category;
            triageActions.innerHTML = actions;
            treatmentPlan.innerHTML = treatment + fluidNote;

            // Change background theme based on triage
            changeBackgroundTheme(themeColor);

            // Show triage section with animation
            triageSection.classList.add('show');
        }

        function changeBackgroundTheme(color) {
            const body = document.body;
            
            // Remove existing theme classes
            body.classList.remove('theme-red', 'theme-yellow', 'theme-green', 'theme-black');
            
            // Add new theme class
            body.classList.add(`theme-${color}`);
        }

        // Show body selection after AI analysis
        function showResults(result) {
            document.getElementById('burnType').textContent = result.predicted_class || result.prediction || 'Unknown';
            document.getElementById('confidence').textContent = ((result.confidence || 0) * 100).toFixed(1) + '%';
            document.getElementById('results').style.display = 'block';
            
            // Show body part selection after results
            document.getElementById('bodySelection').style.display = 'block';
        }
    </script>
</body>
</html>
